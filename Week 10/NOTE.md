# 浏览器工作原理（三）

## 排版（layout）

1. 根据浏览器属性进行排版

   * 准备工作，抽象主轴与交叉轴

2. 收集元素进行

   * 分行，根据主轴尺寸把元素分进行
   * 若设置了 no-wrap，则强行分配进第一行
  
3. 计算主轴

   * 找出所有Flex元素
   * 把主轴方向的剩余尺寸按比例分配给这些元素
   * 若剩余空间为负数,所有flex元素为0,等比压缩剩余元素

4. 计算交叉轴

   * 根据每一行中最大元素尺寸计算行高
   * 根据行高 flex-align 和 item-align，确定元素具体位置

## 渲染

1. 绘制单个元素

   * 绘制需要依赖一个图形环境
   * 采用了 npm 包 images
   * 绘制在一个 viewport 上进行
   * 与绘制相关的属性: background-color、border、background-image等

2. 绘制DOM树

   * 递归调用 render 函数完成 DOM 树的绘制
